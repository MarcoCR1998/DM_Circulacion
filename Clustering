
import pandas as pd
import numpy as np
from sklearn.cluster import KMeans
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
import matplotlib.pyplot as plt

# Cargar los datos (reemplaza 'archivo.csv' con tu archivo real)
data_path = "C:/Users/marco/Desktop/29/salida.csv"  # Cambiar esto por la ruta real de tu archivo
data = pd.read_csv(data_path)

# Selección de columnas relevantes
selected_columns = [
    'regional', 'departamento', 'municipio',  # Segmentación geográfica
    'envio_total', 'flete', 'devuelto',  # Patrones de distribución
    'nomCanal', 'sectorista', 'supervisor'  # Canales y supervisión
]
data = data[selected_columns]

# Preprocesamiento
# Separar variables categóricas y numéricas
categorical_columns = ['regional', 'departamento', 'municipio', 'nomCanal', 'sectorista', 'supervisor']
numerical_columns = ['envio_total', 'flete', 'devuelto']

# Pipeline de preprocesamiento
preprocessor = ColumnTransformer([
    ('num', StandardScaler(), numerical_columns),
    ('cat', OneHotEncoder(drop='first'), categorical_columns)
])

# Construir pipeline completo con K-Means
kmeans_pipeline = Pipeline([
    ('preprocessor', preprocessor),
    ('kmeans', KMeans(n_clusters=5, random_state=42))  # Cambia el número de clusters si es necesario
])

# Ajustar el modelo
kmeans_pipeline.fit(data)

# Obtener los clusters
data['cluster'] = kmeans_pipeline['kmeans'].labels_

# Visualización inicial de los clusters usando dos variables principales
plt.figure(figsize=(10, 6))
plt.scatter(
    data['envio_total'], data['flete'], c=data['cluster'], cmap='viridis', s=50
)
plt.title('Clusters basados en K-Means')
plt.xlabel('envio_total')
plt.ylabel('flete')
plt.colorbar(label='Cluster')
plt.show()

# Guardar los resultados con los clusters
data.to_csv('resultado_clusters.csv', index=False)
print("Clustering completado. Los resultados se han guardado en 'resultado_clusters.csv'.")


